<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>E-posta Doğrulama • Toplansın</title>
  <style>
    :root{--emerald:#10b981}
    html,body{height:100%}
    body{
      margin:0;display:grid;place-items:center;min-height:100%;
      background:#081411;color:#e6fff4;font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }
    .card{
      width:min(560px,92vw);background:#0c1713;border:1px solid rgba(34,197,94,.18);
      border-radius:16px;padding:28px;box-shadow:0 20px 60px rgba(0,0,0,.55)
    }
    h1{margin:0 0 8px;font-size:22px}
    .muted{color:#9ccdb9}
    .ok{color:#14e59b}
    .err{color:#ff7575}
    .btn{
      display:inline-block;margin-top:18px;background:linear-gradient(135deg,#047857,#10b981);
      color:#04160f;padding:12px 18px;border-radius:12px;font-weight:800;text-decoration:none
    }
    @media (prefers-color-scheme: light){
      body{background:#f3f7f5;color:#0c1b14}
      .card{background:#fff;border-color:#d9efe5;box-shadow:0 10px 28px rgba(7,59,37,.08)}
    }
  </style>
</head>
<body>
  <div class="card">
    <h1 id="title">E-posta doğrulanıyor…</h1>
    <p class="muted" id="desc">Lütfen bekleyin.</p>
    <a id="cta" class="btn" style="display:none" href="/">Uygulamaya Dön</a>
  </div>

  <script type="module">
    // --- Firebase (modüler SDK, <script type="module"> ile) ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getAuth, applyActionCode, checkActionCode } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

    // 🔽 Konsoldan aldığın web config’i buraya yapıştır:
    const firebaseConfig = {
      apiKey: "AIz...QdQ4",
      authDomain: "toplansin-e4363.firebaseapp.com",
      projectId: "toplansin-e4363",
      storageBucket: "toplansin-e4363.appspot.com",
      messagingSenderId: "456...964",
      appId: "1:456...964:web:...e969",
      // measurementId opsiyonel
    };

    // --- Init ---
    initializeApp(firebaseConfig);
    const auth = getAuth();

    // --- URL paramlarını al ---
    const params = new URLSearchParams(location.search);
    const mode = params.get("mode");
    const oobCode = params.get("oobCode");
    const continueUrl = params.get("continueUrl") || "/"; // istersen burada /app, /auth-done yap

    const $ = (id)=>document.getElementById(id);
    const set = (id, html)=>{$(id).innerHTML = html};

    async function run(){
      if (mode !== "verifyEmail" || !oobCode) {
        set("title","Geçersiz bağlantı");
        set("desc","Kod veya mod parametresi eksik.");
        $("desc").className = "err";
        return;
      }
      try {
        // (Opsiyonel) kod geçerli mi kontrol et
        await checkActionCode(auth, oobCode);

        // Asıl doğrulama
        await applyActionCode(auth, oobCode);

        set("title", "E-posta doğrulandı 🎉");
        set("desc", "Hesabın başarıyla aktifleştirildi.");
        $("desc").className = "ok";

        // “Devam Et” düğmesi
        const cta = $("cta");
        cta.href = continueUrl;
        cta.style.display = "inline-block";

        // Otomatik yönlendirme (isteğe bağlı)
        // setTimeout(()=>location.assign(continueUrl), 1200);
      } catch (e){
        console.error(e);
        set("title","Doğrulama başarısız");
        set("desc","Bağlantı süresi dolmuş veya daha önce kullanılmış olabilir. Lütfen yeniden deneyin.");
        $("desc").className = "err";
      }
    }
    run();
  </script>
</body>
</html>
