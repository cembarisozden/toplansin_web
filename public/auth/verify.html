<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Toplansƒ±n ‚Ä¢ Hesap ƒ∞≈ülemi</title>

  <!-- ƒ∞steƒüe baƒülƒ±: modern font -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      /* Tema renkleri */
      --bg:#07130f;
      --card:rgba(10,22,18,.6);
      --glass:rgba(255,255,255,.08);
      --ink:#e7fff5;
      --muted:#91cbb3;
      --ok:#22e6a8;
      --err:#ff7474;
      --stroke:rgba(120,255,200,.18);

      --brand-1:#00f5a0;
      --brand-2:#00d9f5;
      --brand-3:#10b981;
      --brand-4:#34d399;

      --radius-xl:22px;
      --radius-lg:16px;
      --radius-sm:12px;
      --shadow-lg:0 30px 120px rgba(0,0,0,.55);
      --shadow-sm:0 8px 30px rgba(0,0,0,.25);
    }

    @media (prefers-color-scheme:light){
      :root{
        --bg:#eef7f3;
        --card:rgba(255,255,255,.75);
        --glass:rgba(0,0,0,.05);
        --ink:#0b221a;
        --muted:#3f5c4f;
        --stroke:rgba(16,185,129,.18);
      }
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;min-height:100%;display:grid;place-items:center;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--ink);
      overflow:hidden;
      background:
        radial-gradient(1200px 520px at 10% -10%, rgba(0,245,160,.18), transparent 60%),
        radial-gradient(900px 420px at 110% 20%, rgba(0,217,245,.15), transparent 60%),
        linear-gradient(160deg, #06100d 0%, #08130f 35%, #0a1712 100%);
    }

    /* Dekoratif gradient baloncuklar */
    .blobs::before, .blobs::after{
      content:""; position:absolute; inset:auto;
      width:42vmax; height:42vmax; filter:blur(60px); opacity:.25; z-index:0;
      background:radial-gradient(closest-side, var(--brand-2), transparent);
      border-radius:50%;
      animation: float 18s ease-in-out infinite;
    }
    .blobs::after{
      right:-12vmax; top:-10vmax;
      background:radial-gradient(closest-side, var(--brand-3), transparent);
      animation-duration: 22s;
    }
    .blobs::before{
      left:-14vmax; bottom:-12vmax;
    }
    @keyframes float{
      0%,100%{ transform:translateY(0) }
      50%{ transform:translateY(-2.5vmax) }
    }

    .wrap{
      position:relative; z-index:1; width:min(760px,92vw); padding:24px;
    }

    .card{
      position:relative;
      border-radius:var(--radius-xl);
      background:linear-gradient(180deg, var(--card), rgba(10,22,18,.92));
      backdrop-filter: blur(14px);
      border:1px solid var(--stroke);
      box-shadow:var(--shadow-lg);
      padding:28px;
    }

    .header{
      display:flex; align-items:center; gap:14px; margin-bottom:14px;
    }
    .logo{height:30px}
    .chip{
      margin-left:auto;
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px; border-radius:999px; font-weight:900; letter-spacing:.3px;
      color:#042015;
      background:linear-gradient(135deg, var(--brand-4) 0%, var(--brand-3) 55%, var(--brand-2) 100%);
      border:1px solid rgba(255,255,255,.18);
      box-shadow:var(--shadow-sm);
    }

    .status{
      display:flex; align-items:center; gap:10px;
      padding:10px 12px; border-radius:12px; margin:8px 0 6px;
      background:var(--glass); border:1px solid var(--stroke);
      font-weight:700; letter-spacing:.2px;
    }
    .status.ok{ color:var(--ok) }
    .status.err{ color:var(--err) }

    h1{margin:10px 0 6px; font-size:26px; letter-spacing:.2px}
    p{margin:6px 0 0}
    .muted{ color:var(--muted) }

    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      margin-top:20px; padding:14px 18px; border-radius:var(--radius-sm);
      font-weight:900; text-decoration:none; cursor:pointer; user-select:none;
      color:#052116;
      background:linear-gradient(135deg, #06b37e, #12e3a4);
      border:1px solid rgba(255,255,255,.22);
      box-shadow:0 8px 24px rgba(0, 220, 160, .25);
      transition: transform .08s ease, box-shadow .2s ease, filter .2s ease;
    }
    .btn:hover{ filter:saturate(1.15) brightness(1.05) }
    .btn:active{ transform:translateY(1px) }

    .grid{ display:grid; grid-template-columns:1fr; gap:14px; margin-top:8px }
    @media (min-width:560px){ .grid{ grid-template-columns:1fr 1fr } }

    .field{ display:flex; flex-direction:column; gap:8px }
    .label{ font-weight:800; font-size:14px }
    .control{
      position:relative;
      border-radius:var(--radius-sm);
      border:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      overflow:hidden;
    }
    .control input{
      width:100%; padding:14px 14px 14px 44px;
      background:transparent; outline:none; border:0; color:var(--ink);
      font-size:15px;
    }
    .control .icon{
      position:absolute; left:12px; top:50%; transform:translateY(-50%);
      opacity:.65; pointer-events:none; font-size:18px;
    }
    .hint{font-size:12px; color:var(--muted)}

    .actions{ display:flex; gap:12px; flex-wrap:wrap; margin-top:6px }
    .actions .btn{ flex:1 }

    .hide{ display:none !important }

    /* k√º√ß√ºk ba≈üarƒ± konfeti (yalƒ±n) */
    .confetti{ position:absolute; inset:0; pointer-events:none; opacity:0; transition:opacity .2s ease }
    .confetti.show{ opacity:1 }
    .confetti::before, .confetti::after{
      content:"‚ú®"; position:absolute; font-size:22px; animation: pop .9s ease forwards;
    }
    .confetti::before{ left:16%; top:6% }
    .confetti::after{ right:10%; top:10% }
    @keyframes pop{
      0% { transform:translateY(0) scale(.8); opacity:.0 }
      40% { opacity:1 }
      100%{ transform:translateY(-18px) scale(1); opacity:.0 }
    }
  </style>
</head>
<body>
  <div class="blobs"></div>

  <div class="wrap">
    <div class="card">
      <div class="header">
        <img class="logo" src="/logo.png" alt="Toplansƒ±n" />
        <div class="chip">‚öΩ Toplansƒ±n</div>
      </div>

      <div id="status" class="status">
        <span id="statusIcon">‚è≥</span>
        <span>ƒ∞≈ülem yapƒ±lƒ±yor‚Ä¶</span>
      </div>

      <h1 id="title">ƒ∞≈ülem hazƒ±rlanƒ±yor</h1>
      <p id="desc" class="muted">L√ºtfen bekleyin.</p>

      <!-- Ba≈üarƒ± CTA -->
      <a id="cta" class="btn hide" href="/">Uygulamaya D√∂n</a>

      <!-- ≈ûifre sƒ±fƒ±rlama -->
      <form id="resetForm" class="hide" novalidate>
        <div class="grid">
          <div class="field">
            <label class="label" for="pw1">Yeni ≈üifre</label>
            <div class="control">
              <span class="icon">üîí</span>
              <input id="pw1" name="pw1" type="password" autocomplete="new-password" required />
            </div>
            <div class="hint">En az 6 karakter ve <b>en az 1 rakam</b> i√ßermeli.</div>
          </div>

          <div class="field">
            <label class="label" for="pw2">Yeni ≈üifre (tekrar)</label>
            <div class="control">
              <span class="icon">‚úÖ</span>
              <input id="pw2" name="pw2" type="password" autocomplete="new-password" required />
            </div>
          </div>
        </div>

        <div class="actions">
          <button id="submitBtn" type="submit" class="btn">≈ûifreyi Kaydet</button>
          <a id="cancelBtn" class="btn" href="/">Vazge√ß</a>
        </div>
      </form>

      <div id="fx" class="confetti"></div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import {
      getAuth, applyActionCode, checkActionCode,
      verifyPasswordResetCode, confirmPasswordReset
    } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

    /* üîß Web config ‚Äî projendekiyle birebir aynƒ± olmalƒ± */
    const firebaseConfig = {
      apiKey: "AIzaSyCdwm1oNvZ_9R306ukmd_M2_n7iCudRcQ4",
      authDomain: "toplansin-e4363.firebaseapp.com",
      projectId: "toplansin-e4363",
      storageBucket: "toplansin-e4363.firebasestorage.app",
      messagingSenderId: "450679317964",
      appId: "1:450679317964:web:08de0d07bb040cf848e969",
      measurementId: "G-CVPG2R0XGB"
    };

    initializeApp(firebaseConfig);
    const auth = getAuth();

    const $ = (id)=>document.getElementById(id);
    const set = (id, html)=>{ $(id).innerHTML = html; };
    const show = (id)=>$(id).classList.remove("hide");
    const hide = (id)=>$(id).classList.add("hide");

    const qp = new URLSearchParams(location.search);
    const mode = qp.get("mode");
    const oobCode = qp.get("oobCode");
    const continueUrl = qp.get("continueUrl") || "/";

    const statusEl = $("status");
    const statusIcon = $("statusIcon");
    function setStatus(type, text){
      statusEl.className = "status " + (type || "");
      statusEl.querySelector("span:nth-child(2)").textContent = text;
      statusIcon.textContent = type === "ok" ? "üéâ" : type === "err" ? "‚ö†Ô∏è" : "‚è≥";
    }

    function sparkle(){ $("fx").classList.add("show"); setTimeout(()=>$("fx").classList.remove("show"), 900); }

    function fail(title, msg){
      set("title", title); set("desc", msg);
      $("desc").className = "state-err";
      setStatus("err", "ƒ∞≈ülem ba≈üarƒ±sƒ±z");
      hide("resetForm"); show("cta");
    }

    async function handleVerifyEmail(){
      if (!oobCode) return fail("Ge√ßersiz baƒülantƒ±", "Kod (oobCode) bulunamadƒ±.");
      try{
        setStatus("", "Kod doƒürulanƒ±yor‚Ä¶");
        await checkActionCode(auth, oobCode);
        await applyActionCode(auth, oobCode);
        set("title","E-posta doƒürulandƒ±");
        set("desc","Hesabƒ±n ba≈üarƒ±yla aktifle≈ütirildi.");
        $("desc").className = "state-ok";
        setStatus("ok", "Doƒürulama tamamlandƒ±");
        const cta = $("cta"); cta.href = continueUrl; show("cta");
        sparkle();
        // Otomatik y√∂nlendirme istersen:
        // setTimeout(()=>location.replace(continueUrl), 1200);
      }catch(e){
        console.error(e);
        fail("Doƒürulama ba≈üarƒ±sƒ±z", "Baƒülantƒ± s√ºresi dolmu≈ü veya daha √∂nce kullanƒ±lmƒ±≈ü olabilir. L√ºtfen yeni bir doƒürulama isteyin.");
      }
    }

    async function handleResetPassword(){
      if (!oobCode) return fail("Ge√ßersiz baƒülantƒ±", "Kod (oobCode) bulunamadƒ±.");
      try{
        setStatus("", "Kod kontrol ediliyor‚Ä¶");
        await verifyPasswordResetCode(auth, oobCode);
        set("title","Yeni ≈üifreni belirle");
        set("desc","A≈üaƒüƒ±dan g√º√ßl√º bir ≈üifre olu≈ütur."); $("desc").className = "muted";
        setStatus("", "Hazƒ±r");
        show("resetForm");
      }catch(e){
        console.error(e);
        fail("Kod ge√ßersiz", "Baƒülantƒ± s√ºresi dolmu≈ü veya zaten kullanƒ±lmƒ±≈ü olabilir. L√ºtfen yeni bir sƒ±fƒ±rlama isteyin.");
      }
    }

    // ‚úì ≈ûifre politikasƒ±: min 6, en az 1 rakam
    function validPassword(p){ return /^(?=.*\d).{6,}$/.test(p); }

    $("resetForm").addEventListener("submit", async (ev)=>{
      ev.preventDefault();
      const p1 = $("pw1").value.trim();
      const p2 = $("pw2").value.trim();
      if (!validPassword(p1)) return alert("≈ûifre en az 6 karakter olmalƒ± ve en az 1 rakam i√ßermeli.");
      if (p1 !== p2) return alert("≈ûifreler e≈üle≈ümiyor.");
      $("submitBtn").disabled = true;

      try{
        setStatus("", "≈ûifre g√ºncelleniyor‚Ä¶");
        await confirmPasswordReset(auth, oobCode, p1);
        set("title","≈ûifre g√ºncellendi");
        set("desc","Yeni ≈üifrenle giri≈ü yapabilirsin."); $("desc").className="state-ok";
        setStatus("ok", "ƒ∞≈ülem tamam");
        hide("resetForm");
        const cta=$("cta"); cta.href=continueUrl; cta.textContent="Uygulamaya D√∂n"; show("cta");
        sparkle();
      }catch(e){
        console.error(e);
        alert("≈ûifre g√ºncellenemedi. L√ºtfen farklƒ± bir ≈üifre deneyin.");
        $("submitBtn").disabled = false;
        setStatus("err", "G√ºncelleme ba≈üarƒ±sƒ±z");
      }
    });

    (async()=>{
      if (mode === "verifyEmail") await handleVerifyEmail();
      else if (mode === "resetPassword") await handleResetPassword();
      else fail("Ge√ßersiz istek","mode parametresi eksik veya desteklenmiyor.");
    })();
  </script>
</body>
</html>
